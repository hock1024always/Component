# 场景分析

针对直播弹幕的场景，首先对于服务端中的推模式和拉模式进行分析

## 推拉模式的分析

### 拉模式

缺点

- 数据更新频率低，则**大多数请求都是无效**的
- 在线用户数量多，服务端的**查询负载很高**
- 定时轮训拉取，无法满足时效性要求

### 推模式

优点

- 仅在数据更新时才需要推送
- 数据更新后可以立即推送

缺点

- 需要维护大量的在线长连接

## 技术方案

在浏览器中，长连接的实现我们选择使用基于`Websocket`的推送，原因如下：

- 浏览器支持的socket编程，**轻松维持**服务端的**长连接**
- 基于TCP的可靠传输协议之上的协议，**无需关心通信的细节**
- 提供了高度抽象的编程接口，**业务开发成本低**

# `Websocket`协议内容

## 传输流程

![客户端服务端传输方式](./picture/客户端服务端传输方式.png)

- 前两次的交互是基于http协议，对于升级的请求与响应
- 之后的两次传输（实线）是基于`Websocket`，彼此之间没有依赖关系（即双端都可以主动向对方推送message），message是`Websocket`协议传输的编程基本单位

## 传输原理

- 协议升级之后，继续**复用**HTTP的底层socket完成后续通讯